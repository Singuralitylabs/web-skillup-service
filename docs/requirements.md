# Web技術学習支援サービス 要件定義書

## 1. プロジェクト概要

### 1.1 目的
「AIと学ぶ実践Web技術講座」の学習フェーズを支援するWebアプリケーション。学習コンテンツの配信、進捗管理、課題提出の機能を提供する。

### 1.2 関連事業
生成AI活用Web技術学習支援事業（2026年4月開講予定）

### 1.3 システム構成
本サービスは2つのWebアプリケーションで構成される。

| サービス | 役割 | URL（開発環境） |
|:--|:--|:--|
| シンラボポータルサイト | ログイン、ユーザー登録、承認管理 | `http://localhost:3001` |
| 学習支援サービス（本アプリ） | 学習コンテンツ配信、進捗管理、課題提出 | `http://localhost:3000` |

### 1.4 技術スタック
| 項目 | 技術 |
|:--|:--|
| フロントエンド | Next.js 16.1.6 (App Router, Turbopack) |
| UI フレームワーク | React 19.2.3 |
| スタイリング | Tailwind CSS 4 + @tailwindcss/typography |
| 言語 | TypeScript 5 |
| ランタイム / パッケージマネージャー | Bun |
| コード品質 | Biome 2.3.14 (リンター + フォーマッター) |
| バックエンド / DB / 認証 | Supabase (PostgreSQL + Auth + RLS) |
| アイコン | Lucide React |
| Markdown表示 | react-markdown + remark-gfm |
| 動画埋め込み | react-youtube |
| XSS対策 | isomorphic-dompurify |
| ホスティング | Vercel |
| 運用コスト | 無料枠で運用（初期） |

### 1.5 関連設計書
| ドキュメント | 内容 |
|:--|:--|
| [データベース設計書](./database-design.md) | テーブル定義、RLS、インデックス、トリガー |
| [機能設計書](./functional-design.md) | アーキテクチャ、機能詳細、API仕様、画面設計 |

---

## 2. ユーザー種別と権限

### 2.1 ユーザー種別

| 種別 | DB上のロール | 説明 |
|:--|:--|:--|
| 受講生 | `member` | コンテンツ閲覧、進捗管理、課題提出を行う |
| 講師 / 運営 | `maintainer` | コンテンツ管理（CRUD）を行う |
| システム管理者 | `admin` | 全権限を持つ |

### 2.2 ユーザーステータス

| ステータス | 説明 |
|:--|:--|
| `pending` | 承認待ち（ポータルサイトの承認待ちページへリダイレクト） |
| `active` | 承認済み（学習サービスにアクセス可能） |
| `rejected` | 却下済み（ポータルサイトの却下ページへリダイレクト） |

### 2.3 権限一覧

| 機能 | 受講生 (member) | 講師 / 運営 (maintainer) | システム管理者 (admin) |
|:--|:--:|:--:|:--:|
| コンテンツ閲覧 | ○ | ○ | ○ |
| 自分の進捗確認 | ○ | ○ | ○ |
| 課題提出 | ○ | ○ | ○ |
| 提出履歴の確認 | ○ | ○ | ○ |
| コンテンツ管理（CRUD） | - | ○ | ○ |
| 受講生一覧・進捗一覧 | - | - | ○ |
| 提出課題の一覧確認 | - | - | ○ |
| 管理ダッシュボード | - | - | ○ |

---

## 3. 機能要件

### 3.1 認証・ユーザー管理
- Googleアカウントによるログイン（Supabase Auth）
- 認証機能はポータルサイト側で提供
- 本アプリは認証済みかつ `active` ステータスのユーザーのみアクセス可能
- ミドルウェアによるページ単位のアクセス制御

### 3.2 学習コンテンツ配信

#### コンテンツ構成（3階層）
```
Phase（例：Phase 1 - GAS基礎）
  └── Week（例：Week 1 - はじめの一歩）
        ├── 動画教材（複数）
        ├── テキスト教材（複数）
        └── 演習課題（複数）
```

#### コンテンツ種別
| 種別 | 表示方法 |
|:--|:--|
| 動画（video） | YouTubeの限定公開動画を埋め込み表示 |
| テキスト（text） | Markdown形式で記述・表示（GFM対応、XSSサニタイズ） |
| 演習（exercise） | Markdown形式の演習指示を表示、課題提出フォームと連携 |

#### コンテンツ表示制御
- `is_published` フラグで公開 / 非公開を制御
- `is_deleted` フラグで論理削除（データ保全）
- `display_order` で表示順を制御

### 3.3 進捗管理
- 各コンテンツに「完了」ボタンを配置
- 受講生が手動で完了 / 未完了をトグル
- ダッシュボードに全体・Phase単位・Week単位の進捗率を表示
- 管理者は受講生一覧で各受講生の進捗率・最終アクティビティを確認可能

### 3.4 課題提出
- **コード提出**: GASコードをテキストエリアに貼り付け
- **URL提出**: スプレッドシート / GASプロジェクトのURL共有
- 提出履歴を一覧で確認可能
- 点数・合否判定は行わない
- 提出期限は目安のみ（強制なし）

### 3.5 管理機能
- **管理ダッシュボード**: フェーズ数、週数、コンテンツ数、受講生数、提出数の統計表示
- **コンテンツ管理**: Phase / Week / コンテンツのCRUD操作
- **受講生管理**: 全受講生の進捗一覧、最終アクティビティ追跡
- **提出管理**: 全受講生の提出一覧表示

---

## 4. 画面一覧

### 4.1 受講生向け画面

| パス | 画面名 | 概要 |
|:--|:--|:--|
| `/` | ダッシュボード | 全体進捗率、Phase別進捗バー、学習への導線 |
| `/learn` | Phase一覧 | 公開Phaseの一覧表示 |
| `/learn/[phaseId]` | Week一覧 | Phase内のWeek一覧、進捗表示 |
| `/learn/[phaseId]/[weekId]` | コンテンツ一覧 | Week内のコンテンツ一覧、進捗表示 |
| `/learn/[phaseId]/[weekId]/[contentId]` | コンテンツ詳細 | 動画/テキスト/演習の表示、完了ボタン、課題提出 |
| `/submissions` | 提出履歴 | 自分の提出済み課題一覧 |

### 4.2 管理者向け画面

| パス | 画面名 | 概要 |
|:--|:--|:--|
| `/admin` | 管理ダッシュボード | 統計サマリー |
| `/admin/students` | 受講生一覧 | 全受講生の進捗率、最終アクティビティ |
| `/admin/submissions` | 提出管理 | 全提出一覧 |
| `/admin/phases` | フェーズ管理 | PhaseのCRUD |
| `/admin/weeks` | 週管理 | WeekのCRUD |
| `/admin/contents` | コンテンツ管理 | コンテンツのCRUD |

---

## 5. 非機能要件

### 5.1 対応デバイス
- **PC**: メイン利用を想定、フル機能
- **スマートフォン / タブレット**: レスポンシブ対応（モバイルドロワーナビゲーション）

### 5.2 パフォーマンス
- 初期受講生規模：10〜20名
- Supabase / Vercel無料枠で対応可能な範囲
- Server Componentsによるサーバーサイドレンダリング
- 並列データ取得による高速化

### 5.3 セキュリティ
- Supabase Authによる認証
- ミドルウェアによるページ単位のアクセス制御
- 承認済み（active）ユーザーのみコンテンツアクセス可
- Row Level Security（RLS）によるデータベースレベルのアクセス制御
- isomorphic-dompurifyによるXSSサニタイズ
- サーバーサイドでのユーザーID検証（API操作時）

### 5.4 ダークモード対応
- `prefers-color-scheme` によるOS設定連動のライト / ダークモード切り替え
- CSS変数によるテーマカラー管理

---

## 6. 外部連携

| 連携先 | 用途 | 状態 |
|:--|:--|:--|
| YouTube | 動画教材の埋め込み | 実装済み |
| シンラボポータルサイト | 認証・ユーザー管理・承認フロー | 実装済み |

---

## 7. 未実装機能（将来検討）

| 機能 | 備考 | 優先度 |
|:--|:--|:--|
| Slack通知（運営向け） | 課題提出時・新規登録時のWebhook通知 | 高 |
| フィードバック機能 | 講師から受講生への課題フィードバック | 高 |
| メール通知（受講生向け） | 承認完了時・フィードバック返信時 | 中 |
| お知らせ機能 | 運営から全受講生への連絡機能 | 中 |
| 決済機能 | 外部サービス（Stripe等）で対応 | 低 |
| プラン別機能制限 | 初期は全プラン同一機能 | 低 |
| 遅れアラート | 進捗が遅れている受講生の自動検知 | 低 |
| 学習時間記録 | アプリ利用時間の計測 | 低 |
| コミュニティ機能 | Slack / Discordで代替 | 低 |
| GitHub連携 | 課題提出はコード貼り付け / URL共有で対応 | 低 |

---

## 8. 今後の検討事項

- 課題フィードバック機能の設計・実装
- Slack Webhook通知の導入
- お知らせ機能の設計・実装
- 決済機能の組み込み時期・方法
- Phase 2（HTML/CSS/JS）、Phase 3（React）への拡張
- 受講生規模拡大時のプラン変更（Supabase / Vercel有料プラン）
- βテストの実施方法・フィードバック収集

---

## 改訂履歴

| 日付 | 内容 |
|:--|:--|
| 2024年12月 | 初版作成 |
| 2026年2月 | 実装内容に基づき全面更新。データモデル・API・画面一覧・セキュリティ等を追記。未実装機能を整理 |
| 2026年2月 | データベース設計書・機能設計書を分離。要件定義書からDB詳細・機能詳細・API仕様を削除し、関連設計書への参照を追加 |
